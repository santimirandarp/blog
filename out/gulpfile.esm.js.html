<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="utf-8">
    <title>JSDoc: Source: gulpfile.esm.js</title>

    <script src="scripts/prettify/prettify.js"> </script>
    <script src="scripts/prettify/lang-css.js"> </script>
    <!--[if lt IE 9]>
      <script src="//html5shiv.googlecode.com/svn/trunk/html5.js"></script>
    <![endif]-->
    <link type="text/css" rel="stylesheet" href="styles/prettify-tomorrow.css">
    <link type="text/css" rel="stylesheet" href="styles/jsdoc-default.css">
</head>

<body>

<div id="main">

    <h1 class="page-title">Source: gulpfile.esm.js</h1>

    



    
    <section>
        <article>
            <pre class="prettyprint source linenums"><code>import {src,lastRun,dest,watch,series,parallel} from "gulp";

//workaround for __dirname
import { dirname } from 'path';
import { fileURLToPath } from 'url';
const __dirname = dirname(fileURLToPath(import.meta.url));

import path from 'path';
import imagemin from "gulp-imagemin";
import rename from 'gulp-rename';
import livereload from 'gulp-livereload';

import jsdoc from 'gulp-jsdoc3';
import eslint from 'gulp-eslint';

import gulpSass from 'gulp-sass';
import sassBin from 'sass';
const sass = gulpSass(sassBin);
import postcss from 'gulp-postcss';
import postcssScss from 'postcss-scss' 
import sourcemaps from 'gulp-sourcemaps';
import autoprefixer from 'autoprefixer';


const tpath = {
src:{ 
     docs:['src/local_modules/**/*.js', 'src/routes/**/*.js', '*.js'],
     lintPaths:['src/**/*.js', '!src/node_modules'],
     copyRest:['src/**/*', 'src/**/.*', '!src/node_modules/**/*', '!src/public/**/*'], 
     images:'src/public/images/**/*.{png,svg,jpeg,jpg}', //case insensitive on src()
     scss:'src/public/stylesheets/**/*.scss',
    },
dest:{ 
       images:'dist/public/images/',
       css:'dist/public/stylesheets/',
     }}

const makeDocs = cb => src(tpath.srcs.docs,{read: false}).pipe(jsdoc(cb))

/**
Generates prefixed
*/
const genCSS = () => {
  return src(tpath.src.scss)
    .pipe(sourcemaps.init()) //line in css, maps to source (file &amp; line).
    .pipe(postcss([autoprefixer()],{syntax: postcssScss}))
    .pipe(sass.sync({outputStyle:'compressed'}).on('error', sass.logError))
    .pipe(sourcemaps.write())
    .pipe(dest(tpath.dest.css))
}

/** Function used in @minify(). Replaces filename spaces with underscores, 
' and " are removed, extension is lowercase.
*/
const cleanFilename = (filename, extension)=>{
  //spaces w underscore; ' or " with nothing; lowercase extension
    return filename.replace('/\s+/g','_').replace('/[\'\"]/g',''), extension.toLowerCase()
} 

/**
  minify jpg, png, svg images; 
  replace whitespace with underscore
  improve the extension (all lowercase)
  move them to dist folder
*/
const minify = () => {
  return src(tpath.src.images, {nocase:true,since:lastRun(minify)}).pipe( imagemin([
          //imagemin.gifsicle({interlaced: true}),
          imagemin.optipng({optimizationLevel: 5}),
          imagemin.svgo({ plugins: [ {removeViewBox: true}, {cleanupIDs: false} ] }),
          imagemin.mozjpeg({quality: 75, progressive: true})
    ])).pipe(rename(function (path) {
          path.basename, path.extname = cleanFilename(path.basename, path.extname)
          })).pipe(dest(tpath.dest.images))
}

/** Lint uses gulp-eslint &amp; lint to inspect all js code on the project src.
All the project uses ES6 javascript
*/
const lint = () => {
    return src(tpath.src.lintPaths)
        .pipe(eslint())
        .pipe(eslint.formatEach())
        .pipe(eslint.failAfterError());
}

const copy = () => src(tpath.src.copyRest).pipe(dest('./dist')) 

/** Watch this set of directories and run functions on change */
function watcher () {
    watch(tpath.src.lintPaths, lint)
    watch(tpath.src.copyRest, copy)
    watch(tpath.src.scss, genCSS)
    watch(tpath.src.images, minify)  
    watch('dist/public/**/*', livereload)  
}

const build = series(genCSS, minify, copy, makeDocs)
/*export each task so they can be run from command line using gulp &lt;taskName>*/
export {minify, genCSS, copy, makeDocs, build}
export default series(watcher)
</code></pre>
        </article>
    </section>




</div>

<nav>
    <h2><a href="index.html">Home</a></h2><h3>Global</h3><ul><li><a href="global.html#cleanFilename">cleanFilename</a></li><li><a href="global.html#genCSS">genCSS</a></li><li><a href="global.html#lint">lint</a></li><li><a href="global.html#minify">minify</a></li><li><a href="global.html#watcher">watcher</a></li></ul>
</nav>

<br class="clear">

<footer>
    Documentation generated by <a href="https://github.com/jsdoc/jsdoc">JSDoc 3.6.7</a> on Sun Jul 11 2021 09:08:02 GMT+0200 (Central European Summer Time)
</footer>

<script> prettyPrint(); </script>
<script src="scripts/linenumber.js"> </script>
</body>
</html>
